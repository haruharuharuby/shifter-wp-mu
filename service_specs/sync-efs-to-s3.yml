---
default: &default
  Labels:
    Name: sync-efs-to-s3
  Networks:
  - Target: shifter_net_user
  Name: {{ service_name }}
  TaskTemplate:
    ContainerSpec:
      Env:
        {{#envvars}}
        - "{{envvar}}"
        {{/envvars}}
        {{^envvars}}
        - "DUMMY_ENV=True"
        {{/envvars}}
      Image: {{ image_string }}
      Mounts:
      - Source: {{ efs_point_root }}
        Target: /opt/efs/
        Type: volume
        VolumeOptions:
          DriverConfig:
            Name: efs
      - Target: /run
        Type: tmpfs
      - Target: /tmp
        Type: tmpfs
    LogDriver:
      Name: awslogs
      Options:
        awslogs-group: dockerlog-services
        awslogs-region: us-east-1
        awslogs-stream: {{ service_id }}-s3sync
    Placement:
      Constraints:
        - "node.labels.type == efs-worker"
    RestartPolicy:
      Condition: on-failure
      Delay: 5000
      MaxAttempts: 3

dev:
  <<: *default

prod:
  <<: *default

development:
  <<: *default
  TaskTemplate:
    LogDriver:
      Name: awslogs
      Options:
        awslogs-group: dockerlog-services-development
        awslogs-region: us-east-1
        awslogs-stream: {{ service_id }}-s3sync

production:
  <<: *default

---
default: &default
  image_name: 027273742350.dkr.ecr.us-east-1.amazonaws.com/docker-s3sync
  default_tag: latest
  requires:
    ENV:
      - AWS_ACCESS_KEY_ID
      - AWS_SECRET_ACCESS_KEY
      - S3_REGION
      - S3_BUCKET
      - SITE_ID
      - SERVICE_NAME
  template:
    Labels:
      Name: sync-efs-to-s3
    TaskTemplate:
      ContainerSpec:
        Env: []
        Image: "REPLACE:STR:IMAGEandTAG"
        Mounts:
        - Source: "REPLACE:STR:efs_id"
          Target: /opt/efs/
          Type: volume
          VolumeOptions:
            DriverConfig:
              Name: "REPLACE:STR:EFSID"
      Placement:
        Constraints:
          - "node.labels.type == efs-worker"
      RestartPolicy:
        Condition: on-failure
        Delay: 5000
        MaxAttempts: 3

development:
  <<: *default

production:
  <<: *default
